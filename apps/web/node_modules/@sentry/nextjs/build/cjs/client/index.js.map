{"version":3,"file":"index.js","sources":["../../../src/client/index.ts"],"sourcesContent":["// import/export got a false positive, and affects most of our index barrel files\n// can be removed once following issue is fixed: https://github.com/import-js/eslint-plugin-import/issues/703\n/* eslint-disable import/export */\nimport type { Client, EventProcessor, Integration } from '@sentry/core';\nimport { addEventProcessor, applySdkMetadata, consoleSandbox, getGlobalScope, GLOBAL_OBJ } from '@sentry/core';\nimport type { BrowserOptions } from '@sentry/react';\nimport { getDefaultIntegrations as getReactDefaultIntegrations, init as reactInit } from '@sentry/react';\nimport { devErrorSymbolicationEventProcessor } from '../common/devErrorSymbolicationEventProcessor';\nimport { getVercelEnv } from '../common/getVercelEnv';\nimport { isRedirectNavigationError } from '../common/nextNavigationErrorUtils';\nimport { browserTracingIntegration } from './browserTracingIntegration';\nimport { nextjsClientStackFrameNormalizationIntegration } from './clientNormalizationIntegration';\nimport { INCOMPLETE_APP_ROUTER_INSTRUMENTATION_TRANSACTION_NAME } from './routing/appRouterRoutingInstrumentation';\nimport { removeIsrSsgTraceMetaTags } from './routing/isrRoutingTracing';\nimport { applyTunnelRouteOption } from './tunnelRoute';\n\nexport * from '@sentry/react';\nexport * from '../common';\nexport { captureUnderscoreErrorException } from '../common/pages-router-instrumentation/_error';\n\n// Override core span methods with Next.js-specific implementations that support Cache Components\nexport { startSpan, startSpanManual, startInactiveSpan } from '../common/utils/nextSpan';\nexport { browserTracingIntegration } from './browserTracingIntegration';\nexport { captureRouterTransitionStart } from './routing/appRouterRoutingInstrumentation';\n\nlet clientIsInitialized = false;\n\nconst globalWithInjectedValues = GLOBAL_OBJ as typeof GLOBAL_OBJ & {\n  _sentryRewriteFramesAssetPrefixPath: string;\n  _sentryAssetPrefix?: string;\n  _sentryBasePath?: string;\n  _sentryRelease?: string;\n  _experimentalThirdPartyOriginStackFrames?: string;\n};\n\n// Treeshakable guard to remove all code related to tracing\ndeclare const __SENTRY_TRACING__: boolean;\n\n/** Inits the Sentry NextJS SDK on the browser with the React SDK. */\nexport function init(options: BrowserOptions): Client | undefined {\n  if (clientIsInitialized) {\n    consoleSandbox(() => {\n      // eslint-disable-next-line no-console\n      console.warn(\n        '[@sentry/nextjs] You are calling `Sentry.init()` more than once on the client. This can happen if you have both a `sentry.client.config.ts` and a `instrumentation-client.ts` file with `Sentry.init()` calls. It is recommended to call `Sentry.init()` once in `instrumentation-client.ts`.',\n      );\n    });\n  }\n  clientIsInitialized = true;\n\n  // Remove cached trace meta tags for ISR/SSG pages before initializing\n  // This prevents the browser tracing integration from using stale trace IDs\n  if (typeof __SENTRY_TRACING__ === 'undefined' || __SENTRY_TRACING__) {\n    removeIsrSsgTraceMetaTags();\n  }\n\n  const opts = {\n    environment: getVercelEnv(true) || process.env.NODE_ENV,\n    defaultIntegrations: getDefaultIntegrations(options),\n    release: process.env._sentryRelease || globalWithInjectedValues._sentryRelease,\n    ...options,\n  } satisfies BrowserOptions;\n\n  applyTunnelRouteOption(opts);\n  applySdkMetadata(opts, 'nextjs', ['nextjs', 'react']);\n\n  const client = reactInit(opts);\n\n  const filterTransactions: EventProcessor = event =>\n    event.type === 'transaction' && event.transaction === '/404' ? null : event;\n  filterTransactions.id = 'NextClient404Filter';\n  addEventProcessor(filterTransactions);\n\n  const filterIncompleteNavigationTransactions: EventProcessor = event =>\n    event.type === 'transaction' && event.transaction === INCOMPLETE_APP_ROUTER_INSTRUMENTATION_TRANSACTION_NAME\n      ? null\n      : event;\n  filterIncompleteNavigationTransactions.id = 'IncompleteTransactionFilter';\n  addEventProcessor(filterIncompleteNavigationTransactions);\n\n  const filterNextRedirectError: EventProcessor = (event, hint) =>\n    isRedirectNavigationError(hint?.originalException) || event.exception?.values?.[0]?.value === 'NEXT_REDIRECT'\n      ? null\n      : event;\n  filterNextRedirectError.id = 'NextRedirectErrorFilter';\n  addEventProcessor(filterNextRedirectError);\n\n  if (process.env.NODE_ENV === 'development') {\n    addEventProcessor(devErrorSymbolicationEventProcessor);\n  }\n\n  try {\n    // @ts-expect-error `process.turbopack` is a magic string that will be replaced by Next.js\n    if (process.turbopack) {\n      getGlobalScope().setTag('turbopack', true);\n    }\n  } catch {\n    // Noop\n    // The statement above can throw because process is not defined on the client\n  }\n\n  return client;\n}\n\nfunction getDefaultIntegrations(options: BrowserOptions): Integration[] {\n  const customDefaultIntegrations = getReactDefaultIntegrations(options);\n  // This evaluates to true unless __SENTRY_TRACING__ is text-replaced with \"false\",\n  // in which case everything inside will get tree-shaken away\n  if (typeof __SENTRY_TRACING__ === 'undefined' || __SENTRY_TRACING__) {\n    customDefaultIntegrations.push(browserTracingIntegration());\n  }\n\n  // These values are injected at build time, based on the output directory specified in the build config. Though a default\n  // is set there, we set it here as well, just in case something has gone wrong with the injection.\n  const rewriteFramesAssetPrefixPath =\n    process.env._sentryRewriteFramesAssetPrefixPath ||\n    globalWithInjectedValues._sentryRewriteFramesAssetPrefixPath ||\n    '';\n  const assetPrefix = process.env._sentryAssetPrefix || globalWithInjectedValues._sentryAssetPrefix;\n  const basePath = process.env._sentryBasePath || globalWithInjectedValues._sentryBasePath;\n  const experimentalThirdPartyOriginStackFrames =\n    process.env._experimentalThirdPartyOriginStackFrames === 'true' ||\n    globalWithInjectedValues._experimentalThirdPartyOriginStackFrames === 'true';\n  customDefaultIntegrations.push(\n    nextjsClientStackFrameNormalizationIntegration({\n      assetPrefix,\n      basePath,\n      rewriteFramesAssetPrefixPath,\n      experimentalThirdPartyOriginStackFrames,\n    }),\n  );\n\n  return customDefaultIntegrations;\n}\n\n/**\n * Just a passthrough in case this is imported from the client.\n */\nexport function withSentryConfig<T>(exportedUserNextConfig: T): T {\n  return exportedUserNextConfig;\n}\n"],"names":["GLOBAL_OBJ","consoleSandbox","removeIsrSsgTraceMetaTags","getVercelEnv","applyTunnelRouteOption","applySdkMetadata","reactInit","addEventProcessor","INCOMPLETE_APP_ROUTER_INSTRUMENTATION_TRANSACTION_NAME","isRedirectNavigationError","devErrorSymbolicationEventProcessor","getGlobalScope","getReactDefaultIntegrations","browserTracingIntegration","nextjsClientStackFrameNormalizationIntegration"],"mappings":"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"}