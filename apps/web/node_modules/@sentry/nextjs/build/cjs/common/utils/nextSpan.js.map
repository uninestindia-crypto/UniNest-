{"version":3,"file":"nextSpan.js","sources":["../../../../src/common/utils/nextSpan.ts"],"sourcesContent":["import type { Span, StartSpanOptions } from '@sentry/core';\nimport {\n  debug,\n  SentryNonRecordingSpan,\n  startInactiveSpan as coreStartInactiveSpan,\n  startSpan as coreStartSpan,\n  startSpanManual as coreStartSpanManual,\n} from '@sentry/core';\nimport { DEBUG_BUILD } from '../debug-build';\nimport { isBuild } from './isBuild';\nimport type { ServerReference } from './isUseCacheFunction';\nimport { isUseCacheFunction } from './isUseCacheFunction';\n\nfunction shouldNoopSpan<T>(callback?: T & Partial<ServerReference>): boolean {\n  const isBuildContext = isBuild();\n  const isUseCacheFunctionContext = callback ? isUseCacheFunction(callback) : false;\n\n  if (isUseCacheFunctionContext) {\n    DEBUG_BUILD && debug.log('Skipping span creation in Cache Components context');\n  }\n\n  return isBuildContext || isUseCacheFunctionContext;\n}\n\nfunction createNonRecordingSpan(): Span {\n  return new SentryNonRecordingSpan({\n    traceId: '00000000000000000000000000000000',\n    spanId: '0000000000000000',\n  });\n}\n\n/**\n * Next.js-specific implementation of `startSpan` that skips span creation\n * in Cache Components contexts (which render at build time).\n *\n * When in a Cache Components context, we execute the callback with a non-recording span\n * and return early without creating an actual span, since spans don't make sense at build/cache time.\n *\n * @param options - Options for starting the span\n * @param callback - Callback function that receives the span\n * @returns The return value of the callback\n */\nexport function startSpan<T>(options: StartSpanOptions, callback: (span: Span) => T): T {\n  if (shouldNoopSpan(callback)) {\n    return callback(createNonRecordingSpan());\n  }\n\n  return coreStartSpan(options, callback);\n}\n\n/**\n *\n * When in a Cache Components context, we execute the callback with a non-recording span\n * and return early without creating an actual span, since spans don't make sense at build/cache time.\n *\n * @param options - Options for starting the span\n * @param callback - Callback function that receives the span and finish function\n * @returns The return value of the callback\n */\nexport function startSpanManual<T>(options: StartSpanOptions, callback: (span: Span, finish: () => void) => T): T {\n  if (shouldNoopSpan(callback)) {\n    const nonRecordingSpan = createNonRecordingSpan();\n    return callback(nonRecordingSpan, () => nonRecordingSpan.end());\n  }\n\n  return coreStartSpanManual(options, callback);\n}\n\n/**\n *\n * When in a Cache Components context, we return a non-recording span and return early\n * without creating an actual span, since spans don't make sense at build/cache time.\n *\n * @param options - Options for starting the span\n * @returns A non-recording span (in Cache Components context) or the created span\n */\nexport function startInactiveSpan(options: StartSpanOptions): Span {\n  if (shouldNoopSpan()) {\n    return createNonRecordingSpan();\n  }\n\n  return coreStartInactiveSpan(options);\n}\n"],"names":["isBuild","isUseCacheFunction","DEBUG_BUILD","debug","SentryNonRecordingSpan","coreStartSpan","coreStartSpanManual","coreStartInactiveSpan"],"mappings":";;;;;;;AAaA,SAAS,cAAc,CAAI,QAAQ,EAA0C;AAC7E,EAAE,MAAM,cAAA,GAAiBA,eAAO,EAAE;AAClC,EAAE,MAAM,yBAAA,GAA4B,QAAA,GAAWC,qCAAkB,CAAC,QAAQ,CAAA,GAAI,KAAK;;AAEnF,EAAE,IAAI,yBAAyB,EAAE;AACjC,IAAIC,0BAAeC,UAAK,CAAC,GAAG,CAAC,oDAAoD,CAAC;AAClF,EAAE;;AAEF,EAAE,OAAO,cAAA,IAAkB,yBAAyB;AACpD;;AAEA,SAAS,sBAAsB,GAAS;AACxC,EAAE,OAAO,IAAIC,2BAAsB,CAAC;AACpC,IAAI,OAAO,EAAE,kCAAkC;AAC/C,IAAI,MAAM,EAAE,kBAAkB;AAC9B,GAAG,CAAC;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,SAAS,CAAI,OAAO,EAAoB,QAAQ,EAAwB;AACxF,EAAE,IAAI,cAAc,CAAC,QAAQ,CAAC,EAAE;AAChC,IAAI,OAAO,QAAQ,CAAC,sBAAsB,EAAE,CAAC;AAC7C,EAAE;;AAEF,EAAE,OAAOC,cAAa,CAAC,OAAO,EAAE,QAAQ,CAAC;AACzC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,eAAe,CAAI,OAAO,EAAoB,QAAQ,EAA4C;AAClH,EAAE,IAAI,cAAc,CAAC,QAAQ,CAAC,EAAE;AAChC,IAAI,MAAM,gBAAA,GAAmB,sBAAsB,EAAE;AACrD,IAAI,OAAO,QAAQ,CAAC,gBAAgB,EAAE,MAAM,gBAAgB,CAAC,GAAG,EAAE,CAAC;AACnE,EAAE;;AAEF,EAAE,OAAOC,oBAAmB,CAAC,OAAO,EAAE,QAAQ,CAAC;AAC/C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,iBAAiB,CAAC,OAAO,EAA0B;AACnE,EAAE,IAAI,cAAc,EAAE,EAAE;AACxB,IAAI,OAAO,sBAAsB,EAAE;AACnC,EAAE;;AAEF,EAAE,OAAOC,sBAAqB,CAAC,OAAO,CAAC;AACvC;;;;;;"}