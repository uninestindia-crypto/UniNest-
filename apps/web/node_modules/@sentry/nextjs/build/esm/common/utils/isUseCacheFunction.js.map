{"version":3,"file":"isUseCacheFunction.js","sources":["../../../../src/common/utils/isUseCacheFunction.ts"],"sourcesContent":["// Vendored from: https://github.com/vercel/next.js/blob/canary/packages/next/src/lib/client-and-server-references.ts\n\ninterface ServerReferenceInfo {\n  type: 'server-action' | 'use-cache';\n  usedArgs: [boolean, boolean, boolean, boolean, boolean, boolean];\n  hasRestArgs: boolean;\n}\n\nexport interface ServerReference {\n  $$typeof: symbol;\n  $$id: string;\n}\n\nexport type ServerFunction = ServerReference & ((...args: unknown[]) => Promise<unknown>);\n\nfunction extractInfoFromServerReferenceId(id: string): ServerReferenceInfo {\n  const infoByte = parseInt(id.slice(0, 2), 16);\n  // eslint-disable-next-line no-bitwise\n  const typeBit = (infoByte >> 7) & 0x1;\n  // eslint-disable-next-line no-bitwise\n  const argMask = (infoByte >> 1) & 0x3f;\n  // eslint-disable-next-line no-bitwise\n  const restArgs = infoByte & 0x1;\n  const usedArgs = Array(6);\n\n  for (let index = 0; index < 6; index++) {\n    const bitPosition = 5 - index;\n    // eslint-disable-next-line no-bitwise\n    const bit = (argMask >> bitPosition) & 0x1;\n    usedArgs[index] = bit === 1;\n  }\n\n  return {\n    type: typeBit === 1 ? 'use-cache' : 'server-action',\n    usedArgs: usedArgs as [boolean, boolean, boolean, boolean, boolean, boolean],\n    hasRestArgs: restArgs === 1,\n  };\n}\n\nfunction isServerReference<T>(value: T & Partial<ServerReference>): value is T & ServerFunction {\n  return value.$$typeof === Symbol.for('react.server.reference');\n}\n\n/**\n * Check if the function is a use cache function.\n *\n * @param value - The function to check.\n * @returns true if the function is a use cache function, false otherwise.\n */\nexport function isUseCacheFunction<T>(value: T & Partial<ServerReference>): value is T & ServerFunction {\n  if (!isServerReference(value)) {\n    return false;\n  }\n\n  const { type } = extractInfoFromServerReferenceId(value.$$id);\n\n  return type === 'use-cache';\n}\n"],"names":[],"mappings":"AAAA;;AAeA,SAAS,gCAAgC,CAAC,EAAE,EAA+B;AAC3E,EAAE,MAAM,QAAA,GAAW,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC;AAC/C;AACA,EAAE,MAAM,UAAU,CAAC,YAAY,CAAC,IAAI,GAAG;AACvC;AACA,EAAE,MAAM,UAAU,CAAC,YAAY,CAAC,IAAI,IAAI;AACxC;AACA,EAAE,MAAM,QAAA,GAAW,QAAA,GAAW,GAAG;AACjC,EAAE,MAAM,QAAA,GAAW,KAAK,CAAC,CAAC,CAAC;;AAE3B,EAAE,KAAK,IAAI,KAAA,GAAQ,CAAC,EAAE,KAAA,GAAQ,CAAC,EAAE,KAAK,EAAE,EAAE;AAC1C,IAAI,MAAM,WAAA,GAAc,CAAA,GAAI,KAAK;AACjC;AACA,IAAI,MAAM,MAAM,CAAC,WAAW,WAAW,IAAI,GAAG;AAC9C,IAAI,QAAQ,CAAC,KAAK,IAAI,GAAA,KAAQ,CAAC;AAC/B,EAAE;;AAEF,EAAE,OAAO;AACT,IAAI,IAAI,EAAE,OAAA,KAAY,IAAI,WAAA,GAAc,eAAe;AACvD,IAAI,QAAQ,EAAE,QAAA;AACd,IAAI,WAAW,EAAE,QAAA,KAAa,CAAC;AAC/B,GAAG;AACH;;AAEA,SAAS,iBAAiB,CAAI,KAAK,EAA6D;AAChG,EAAE,OAAO,KAAK,CAAC,QAAA,KAAa,MAAM,CAAC,GAAG,CAAC,wBAAwB,CAAC;AAChE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,kBAAkB,CAAI,KAAK,EAA6D;AACxG,EAAE,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,EAAE;AACjC,IAAI,OAAO,KAAK;AAChB,EAAE;;AAEF,EAAE,MAAM,EAAE,IAAA,EAAK,GAAI,gCAAgC,CAAC,KAAK,CAAC,IAAI,CAAC;;AAE/D,EAAE,OAAO,IAAA,KAAS,WAAW;AAC7B;;;;"}