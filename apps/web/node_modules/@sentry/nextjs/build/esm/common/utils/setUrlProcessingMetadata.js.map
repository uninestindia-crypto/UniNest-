{"version":3,"file":"setUrlProcessingMetadata.js","sources":["../../../../src/common/utils/setUrlProcessingMetadata.ts"],"sourcesContent":["import type { Event } from '@sentry/core';\nimport { getClient } from '@sentry/core';\nimport { getSanitizedRequestUrl } from './urls';\n\n/**\n * Sets the URL processing metadata for the event.\n */\nexport function setUrlProcessingMetadata(event: Event): void {\n  // Skip if not a server-side transaction\n  if (event.type !== 'transaction' || event.contexts?.trace?.op !== 'http.server' || !event.contexts?.trace?.data) {\n    return;\n  }\n\n  // Only add URL if sendDefaultPii is enabled, as URLs may contain PII\n  const client = getClient();\n  if (!client?.getOptions().sendDefaultPii) {\n    return;\n  }\n\n  const traceData = event.contexts.trace.data;\n\n  // Get the route from trace data\n  const componentRoute = traceData['next.route'] || traceData['http.route'];\n  const httpTarget = traceData['http.target'] as string | undefined;\n\n  if (!componentRoute) {\n    return;\n  }\n\n  // Extract headers\n  const isolationScopeData = event.sdkProcessingMetadata?.capturedSpanIsolationScope?.getScopeData();\n  const headersDict = isolationScopeData?.sdkProcessingMetadata?.normalizedRequest?.headers;\n\n  const url = getSanitizedRequestUrl(componentRoute, undefined, headersDict, httpTarget?.toString());\n\n  // Add URL to the isolation scope's normalizedRequest so requestDataIntegration picks it up\n  if (url && isolationScopeData?.sdkProcessingMetadata) {\n    isolationScopeData.sdkProcessingMetadata.normalizedRequest =\n      isolationScopeData.sdkProcessingMetadata.normalizedRequest || {};\n    isolationScopeData.sdkProcessingMetadata.normalizedRequest.url = url;\n  }\n}\n"],"names":[],"mappings":";;;AAIA;AACA;AACA;AACO,SAAS,wBAAwB,CAAC,KAAK,EAAe;AAC7D;AACA,EAAE,IAAI,KAAK,CAAC,IAAA,KAAS,aAAA,IAAiB,KAAK,CAAC,QAAQ,EAAE,KAAK,EAAE,EAAA,KAAO,aAAA,IAAiB,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE;AACnH,IAAI;AACJ,EAAE;;AAEF;AACA,EAAE,MAAM,MAAA,GAAS,SAAS,EAAE;AAC5B,EAAE,IAAI,CAAC,MAAM,EAAE,UAAU,EAAE,CAAC,cAAc,EAAE;AAC5C,IAAI;AACJ,EAAE;;AAEF,EAAE,MAAM,YAAY,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI;;AAE7C;AACA,EAAE,MAAM,cAAA,GAAiB,SAAS,CAAC,YAAY,CAAA,IAAK,SAAS,CAAC,YAAY,CAAC;AAC3E,EAAE,MAAM,UAAA,GAAa,SAAS,CAAC,aAAa,CAAA;;AAE5C,EAAE,IAAI,CAAC,cAAc,EAAE;AACvB,IAAI;AACJ,EAAE;;AAEF;AACA,EAAE,MAAM,kBAAA,GAAqB,KAAK,CAAC,qBAAqB,EAAE,0BAA0B,EAAE,YAAY,EAAE;AACpG,EAAE,MAAM,cAAc,kBAAkB,EAAE,qBAAqB,EAAE,iBAAiB,EAAE,OAAO;;AAE3F,EAAE,MAAM,GAAA,GAAM,sBAAsB,CAAC,cAAc,EAAE,SAAS,EAAE,WAAW,EAAE,UAAU,EAAE,QAAQ,EAAE,CAAC;;AAEpG;AACA,EAAE,IAAI,GAAA,IAAO,kBAAkB,EAAE,qBAAqB,EAAE;AACxD,IAAI,kBAAkB,CAAC,qBAAqB,CAAC,iBAAA;AAC7C,MAAM,kBAAkB,CAAC,qBAAqB,CAAC,iBAAA,IAAqB,EAAE;AACtE,IAAI,kBAAkB,CAAC,qBAAqB,CAAC,iBAAiB,CAAC,GAAA,GAAM,GAAG;AACxE,EAAE;AACF;;;;"}