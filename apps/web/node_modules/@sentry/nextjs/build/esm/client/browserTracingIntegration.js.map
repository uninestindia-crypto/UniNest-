{"version":3,"file":"browserTracingIntegration.js","sources":["../../../src/client/browserTracingIntegration.ts"],"sourcesContent":["import type { Integration } from '@sentry/core';\nimport { browserTracingIntegration as originalBrowserTracingIntegration } from '@sentry/react';\nimport { nextRouterInstrumentNavigation, nextRouterInstrumentPageLoad } from './routing/nextRoutingInstrumentation';\n\n/**\n * A custom browser tracing integration for Next.js.\n */\nexport function browserTracingIntegration(\n  options: Parameters<typeof originalBrowserTracingIntegration>[0] = {},\n): Integration {\n  const browserTracingIntegrationInstance = originalBrowserTracingIntegration({\n    ...options,\n    instrumentNavigation: false,\n    instrumentPageLoad: false,\n    onRequestSpanStart(...args) {\n      const [span, { headers }] = args;\n\n      // Next.js prefetch requests have a `next-router-prefetch` header\n      if (headers?.get('next-router-prefetch')) {\n        span?.setAttribute('http.request.prefetch', true);\n      }\n\n      return options.onRequestSpanStart?.(...args);\n    },\n  });\n\n  const { instrumentPageLoad = true, instrumentNavigation = true } = options;\n\n  return {\n    ...browserTracingIntegrationInstance,\n    afterAllSetup(client) {\n      // We need to run the navigation span instrumentation before the `afterAllSetup` hook on the normal browser\n      // tracing integration because we need to ensure the order of execution is as follows:\n      // Instrumentation to start span on RSC fetch request runs -> Instrumentation to put tracing headers from active span on fetch runs\n      // If it were the other way around, the RSC fetch request would not receive the tracing headers from the navigation transaction.\n      if (instrumentNavigation) {\n        nextRouterInstrumentNavigation(client);\n      }\n\n      browserTracingIntegrationInstance.afterAllSetup(client);\n\n      if (instrumentPageLoad) {\n        nextRouterInstrumentPageLoad(client);\n      }\n    },\n  };\n}\n"],"names":["originalBrowserTracingIntegration"],"mappings":";;;AAIA;AACA;AACA;AACO,SAAS,yBAAyB;AACzC,EAAE,OAAO,GAA4D,EAAE;AACvE,EAAe;AACf,EAAE,MAAM,iCAAA,GAAoCA,2BAAiC,CAAC;AAC9E,IAAI,GAAG,OAAO;AACd,IAAI,oBAAoB,EAAE,KAAK;AAC/B,IAAI,kBAAkB,EAAE,KAAK;AAC7B,IAAI,kBAAkB,CAAC,GAAG,IAAI,EAAE;AAChC,MAAM,MAAM,CAAC,IAAI,EAAE,EAAE,OAAA,EAAS,CAAA,GAAI,IAAI;;AAEtC;AACA,MAAM,IAAI,OAAO,EAAE,GAAG,CAAC,sBAAsB,CAAC,EAAE;AAChD,QAAQ,IAAI,EAAE,YAAY,CAAC,uBAAuB,EAAE,IAAI,CAAC;AACzD,MAAM;;AAEN,MAAM,OAAO,OAAO,CAAC,kBAAkB,GAAG,GAAG,IAAI,CAAC;AAClD,IAAI,CAAC;AACL,GAAG,CAAC;;AAEJ,EAAE,MAAM,EAAE,kBAAA,GAAqB,IAAI,EAAE,oBAAA,GAAuB,IAAA,EAAK,GAAI,OAAO;;AAE5E,EAAE,OAAO;AACT,IAAI,GAAG,iCAAiC;AACxC,IAAI,aAAa,CAAC,MAAM,EAAE;AAC1B;AACA;AACA;AACA;AACA,MAAM,IAAI,oBAAoB,EAAE;AAChC,QAAQ,8BAA8B,CAAC,MAAM,CAAC;AAC9C,MAAM;;AAEN,MAAM,iCAAiC,CAAC,aAAa,CAAC,MAAM,CAAC;;AAE7D,MAAM,IAAI,kBAAkB,EAAE;AAC9B,QAAQ,4BAA4B,CAAC,MAAM,CAAC;AAC5C,MAAM;AACN,IAAI,CAAC;AACL,GAAG;AACH;;;;"}